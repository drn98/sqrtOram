#include<obliv.oh>
#include"testSqrtAccess.h"
#include"sqrtoram.oh"
#include"copy.oh"

void testSqrtAccess(void* vargs)
{
  TestSqrtAccessIO* args = vargs;
  int size = ocBroadcastInt(args->size,2);
  int n = ocBroadcastInt(args->size,1);
  obliv int* content = calloc(n,sizeof(obliv int));
  obliv int* indices = calloc(size,sizeof(obliv int));
  obliv int output;
  feedOblivIntArray(content,args->content,n,1);
  feedOblivIntArray(indices,args->indices,size,2);
  OcOram* ram = (OcOram*)ocSqrtOramNew(&ocCopyInt,content,n);
  args->outputs = malloc(size*sizeof(int));
  for(int i=0;i<size;++i) 
  { ocOramRead(&output,ram,indices[i]);
    revealOblivInt(args->outputs+i,output,0);
  }
  ocOramRelease(ram);
  free(indices);
  free(content);
  args->size=size; // for party 1
}
